<!doctype html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<script src="https://rawgit.com/susielu/d3-annotation/master/d3-annotation.min.js"></script>
<style>
  .mainSVG circle {fill: steelblue;}
  #tooltip {
    opacity: 0;
    position: absolute;
    text-align: center;
    width: 60px; height: 40px;
    background: white;
    border: 0px;
  }
</style>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Narrative Visualization</title>
  </head>
  <body onload="init()">
    <h1>How Properties of Vehicles are Related to Each Other</h1>
    <h4>Data provided by Kaggle: https://www.kaggle.com/datasets/hellbuoy/car-price-prediction</h4>
    <div class="buttons">
      <button onclick="back()"><</button>
      <button id="1" onclick="toSlide(1)">Price VS Fuel Efficiency</button>
      <button id="2" onclick="toSlide(2)">Fuel Efficiency VS Horsepower</button>
      <button id="3" onclick="toSlide(3)">Price VS Horsepower</button>
      <button onclick="forward()">></button>
    </div>
    <svg class="mainSVG" width=750 height=750></svg>
    <div id="tooltip"></div>
    <script>
      var state = 0;
      var data;
      async function init(){
        data = await d3.csv("data/CarPrice.csv");
        toSlide(1);
      }
      function back(){
        if(state > 1){
          state--;
          toSlide(state);
        }
      }
      function forward(){
        if(state < 3){
          state++;
          toSlide(state);
        }
      }
      function clear(){
        d3.selectAll("svg > *").remove();
      }
      function toSlide(curr){
        state = curr;
        clear();
        if(state == 1){
          d3.select("header").text("Price VS Fuel Efficiency");
          draw("price", "citympg");
        }else if(state == 2){
          d3.select("header").text("Fuel Efficiency VS Horsepower");
          draw("citympg", "horsepower");
        }else{
          d3.select("header").text("Price VS Horsepower");
          draw("price", "horsepower");
        }
      }
      function draw(v1, v2){
        var width = 650, height = 650, margin = 50;
        var tooltipAnnotate = [{note: {title: "Explore the data", label: "Mouse over data points for more info"}, x: 100, y: margin}]
        var slide1Annotate = [{note: {title: "Negative Correlation", label: "There is a negative correlation between price and fuel efficiency"}, x: 250, y: 300}]
        var slide2Annotate = [{note: {title: "Negative Correlation", label: "There is a negative correlation between fuel efficiency and horsepower"}, x: 250, y: 300}]
        var slide3Annotate = [{note: {title: "Positive Correlation", label: "There is a positive correlation between price and horsepower"}, x: 250, y: 300}]
        if(v1 == "price" && v2 == "citympg"){
          var xScale = d3.scaleLinear().domain([10, 55]).range([0, width]);
          var yScale = d3.scaleLinear().domain([0, 50000]).range([height, 0]);
          d3.select("svg").append("g").attr("transform", "translate(", + margin + "," + margin + ")").selectAll("circle").data(data).enter().append("circle")
              .attr("cx", function(d) {return xScale(d.citympg);}).attr("cy", function(d) {return yScale(d.price);}).attr("r", 4)
              .on("mouseover", function(d){
                  tooltip.style("opacity", 1).style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY) + "px")
                  .html("Drive Wheel: " + d.drivewheel + "<br/>" + "Number of Cylinders: " + d.cylindernumber + "<br/>" + "Curb Weight: " + d.curbweight);
              })
              .on("mouseout", function() {tooltip.style("opacity", 0)});
          d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + margin + ")").call(d3.axisLeft(yScale)
                                                                                                          .tickValues([0, 10000, 20000, 30000, 40000, 50000]));
          d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + (height + margin) + ")").call(d3.axisBottom(xScale)
                                                                                                          .tickValues([10, 15, 20, 25, 30, 35, 40, 45, 50, 55]));
          d3.select("svg").append("text").attr("class", "ylabel").attr("text-anchor", "end").attr("y", 6).attr("x", -225).attr("transform", "rotate(-90)").text("Price");
          d3.select("svg").append("text").attr("class", "xlabel").attr("text-anchor", "end").attr("x", ((width / 2) + margin)).attr("y", (height + margin + 35)).text("City mpg");
          d3.select("svg").append("g").call(d3.annotation().annotations(slide1Annotate));
        }
        else if(v1 == "citympg" && v2 == "horsepower"){
          var xScale = d3.scaleLinear().domain([40, 280]).range([0, width]);
          var yScale = d3.scaleLinear().domain([10, 55]).range([height, 0]);
          d3.select("svg").append("g").attr("transform", "translate(", + margin + "," + margin + ")").selectAll("circle").data(data).enter().append("circle")
              .attr("cx", function(d) {return xScale(d.horsepower);}).attr("cy", function(d) {return yScale(d.citympg);}).attr("r", 4)
              .on("mouseover", function(d){
                  tooltip.style("opacity", 1).style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY) + "px")
                  .html("Drive Wheel: " + d.drivewheel + "<br/>" + "Number of Cylinders: " + d.cylindernumber + "<br/>" + "Curb Weight: " + d.curbweight);
              })
              .on("mouseout", function() {tooltip.style("opacity", 0)});
          d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + margin + ")").call(d3.axisLeft(yScale)
                                                                                                          .tickValues([10, 15, 20, 25, 30, 35, 40, 45, 50, 55]));
          d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + (height + margin) + ")").call(d3.axisBottom(xScale)
                                                                                                          .tickValues([40, 80, 120, 160, 200, 240, 280]));
          d3.select("svg").append("text").attr("class", "ylabel").attr("text-anchor", "end").attr("y", 6).attr("x", -225).attr("transform", "rotate(-90)").text("City mpg");
          d3.select("svg").append("text").attr("class", "xlabel").attr("text-anchor", "end").attr("x", ((width / 2) + margin)).attr("y", (height + margin + 35)).text("Horsepower");
          d3.select("svg").append("g").call(d3.annotation().annotations(slide2Annotate));
        }else{
          var xScale = d3.scaleLinear().domain([40, 280]).range([0, width]);
          var yScale = d3.scaleLinear().domain([0, 50000]).range([height, 0]);
          d3.select("svg").append("g").attr("transform", "translate(", + margin + "," + margin + ")").selectAll("circle").data(data).enter().append("circle")
              .attr("cx", function(d) {return xScale(d.horsepower);}).attr("cy", function(d) {return yScale(d.price);}).attr("r", 4)
              .on("mouseover", function(d){
                  tooltip.style("opacity", 1).style("left", (d3.event.pageX) + "px").style("top", (d3.event.pageY) + "px")
                  .html("Drive Wheel: " + d.drivewheel + "<br/>" + "Number of Cylinders: " + d.cylindernumber + "<br/>" + "Curb Weight: " + d.curbweight);
              })
              .on("mouseout", function() {tooltip.style("opacity", 0)});
          d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + margin + ")").call(d3.axisLeft(yScale)
                                                                                                          .tickValues([0, 10000, 20000, 30000, 40000, 50000]));
          d3.select("svg").append("g").attr("transform", "translate(" + margin + "," + (height + margin) + ")").call(d3.axisBottom(xScale)
                                                                                                          .tickValues([40, 80, 120, 160, 200, 240, 280]));
          d3.select("svg").append("text").attr("class", "ylabel").attr("text-anchor", "end").attr("y", 6).attr("x", -225).attr("transform", "rotate(-90)").text("Price");
          d3.select("svg").append("text").attr("class", "xlabel").attr("text-anchor", "end").attr("x", ((width / 2) + margin)).attr("y", (height + margin + 35)).text("Horsepower");
          d3.select("svg").append("g").call(d3.annotation().annotations(slide3Annotate));
        }
        d3.select("svg").append("g").call(d3.annotation().annotations(tooltipAnnotate));
      }  
    </script>
  </body>
</html>
